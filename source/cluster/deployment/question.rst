.. _cluster_question:

======================
集群常见故障及解决方案
======================

.. contents:: 目录


介绍
==========

本文档主要记录集群使用过程中所遇到的故障,方便后续维护和使用。

.. ========  =====
.. 故障评级   B  
.. ========  =====
.. False     False
.. True      False
.. ========  =====


.. csv-table:: 故障评级说明
   :header: "故障等级","定义", "说明"
   :widths: 20, 20, 50
   :align: center

   "P1", "重大故障","VPN 不能正常连接，集群出现大面积宕机，系统完全不可用，
   
   宕机时长大于5h并且未能正常恢复"
   "P2", "严重故障", "网络出现故障导致 VPN不能正常连接，
   
   集群未出现宕机情况在小于5个小时内恢复状态"
   "P3", "一般故障", "VPN 能正常连接，大部分主机处于正常工作状态，
   
   少数主机网络不可达或者宕机，1个小时内正常恢复"
   "P4", "轻微故障", "集群整体状态良好，连接速度慢，
   
   或者偶尔断开连接，能通过重连恢复"



故障日志
==========

1. 时间：2021年3月28日

    **故障描述**: vpn 连接不上, 但集群内主机可以正常上网。 (P3故障)

    **排查**: 集群可以正常上网说明集群的联网状态正常那么可能 vpn 服务可能异常。尝试登录 vpn 所在主机, 发现未能正常连接, 说明 vpn 所在主机可能联网状态异常。
    检查网线接口,发现出现松动😂。

    **解决方法**: 重新插拔网线即可。 

2. 时间：2021年3月29日

    **故障描述**: vpn能正常连接，其中一台（host2）连接不上。(P3故障)

    **排查**: 说明是host2出现故障，ping 后发现不可达，有可能是host2资源被占满，或者网络连接错误导致无法响应。
    此时 host2 负载应该较小，排除第一种情况；同时 host2 主机前面板网络连线指示灯正常闪烁，说明网线也是正常连接。
    登入路由器，查看 host2 是否在线，发现 host2 并未出现在 ``Active DHCP Leases`` 中，说明 host2 未能正确获得 IP。

    **解决方法**: 重新插拔网线，使其主动发起 dhcp 请求即可。
